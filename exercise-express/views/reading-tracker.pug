doctype html
html(lang='en')
  head
    meta(charset='UTF-8')
    meta(name='viewport', content='width=device-width, initial-scale=1.0')
    title Reading Tracker
    script(src='https://cdn.tailwindcss.com')
  body.bg-gradient-to-br.from-purple-50.to-pink-100.min-h-screen
    nav.bg-white.shadow-lg
      div(class='max-w-7xl mx-auto px-4 sm:px-6 lg:px-8')
        .flex.justify-between.items-center.h-16
          .flex.items-center.space-x-6
            h1.text-2xl.font-bold.text-purple-600 Reading Tracker
            a.text-indigo-600.font-semibold(href='/books', class='hover:text-indigo-800') All Books
          .flex.items-center.space-x-4
            span.text-gray-700 Welcome, 
              strong= user.username
            form(action='/logout', method='POST')
              button.bg-red-500.text-white.font-semibold.py-2.px-4.rounded.transition.duration-200(type='submit', class='hover:bg-red-600') Logout
    
    main(class='max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8')
      //- Global Statistics Section
      .mb-8
        h2.text-3xl.font-bold.text-gray-800.mb-6 Global Statistics
        div(class='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6')
          //- Total Books
          .bg-white.rounded-lg.shadow-lg.p-6
            .flex.items-center.justify-between
              div
                p.text-gray-500.text-sm.font-semibold Total Books
                p.text-3xl.font-bold.text-purple-600= stats.totalBooks
              .bg-purple-100.p-3.rounded-full
                span.text-3xl 
          
          //- Books Read
          .bg-white.rounded-lg.shadow-lg.p-6
            .flex.items-center.justify-between
              div
                p.text-gray-500.text-sm.font-semibold Books Completed
                p.text-3xl.font-bold.text-green-600= stats.booksRead
              .bg-green-100.p-3.rounded-full
                span.text-3xl 
          
          //- Total Pages
          .bg-white.rounded-lg.shadow-lg.p-6
            .flex.items-center.justify-between
              div
                p.text-gray-500.text-sm.font-semibold Total Pages
                p.text-3xl.font-bold.text-blue-600= stats.totalPages
              .bg-blue-100.p-3.rounded-full
                span.text-3xl
          
          //- Pages Read
          .bg-white.rounded-lg.shadow-lg.p-6
            .flex.items-center.justify-between
              div
                p.text-gray-500.text-sm.font-semibold Pages Read
                p.text-3xl.font-bold.text-indigo-600= stats.totalPagesRead
              .bg-indigo-100.p-3.rounded-full
                span.text-3xl 
        
        //- Overall Progress Bar
        .mt-6.bg-white.rounded-lg.shadow-lg.p-6
          .flex.justify-between.items-center.mb-2
            h3.text-xl.font-bold.text-gray-800 Overall Reading Progress
            span.text-2xl.font-bold.text-purple-600= stats.percentageComplete + '%'
          .w-full.bg-gray-200.rounded-full.h-6
            div.bg-gradient-to-r.from-purple-500.to-pink-500.h-6.rounded-full.transition-all.duration-500(style=`width: ${stats.percentageComplete}%`)
      
      //- Currently Reading Section
      if currentlyReading.length > 0
        .mb-8
          h2.text-3xl.font-bold.text-gray-800.mb-6  Currently Reading
          div(class='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6')
            each book in currentlyReading
              .bg-white.rounded-lg.shadow-lg.p-6
                h3.text-xl.font-bold.text-gray-800.mb-2= book.title
                p.text-gray-600.mb-1
                  span.font-semibold Author: 
                  span= book.author
                .mt-4
                  .flex.justify-between.items-center.mb-2
                    span.text-sm.font-semibold.text-gray-700 Progress
                    span.text-lg.font-bold.text-purple-600= book.readingPercentage + '%'
                  .w-full.bg-gray-200.rounded-full.h-4
                    div.bg-gradient-to-r.from-purple-500.to-pink-500.h-4.rounded-full(style=`width: ${book.readingPercentage}%`)
                  p.text-xs.text-gray-500.mt-2= `${book.numberOfPagesRead} / ${book.numberOfPages} pages`
                .mt-4
                  label.block.text-sm.font-semibold.text-gray-700.mb-2 Update Progress
                  .flex.gap-2
                    input.flex-1.px-3.py-2.border.rounded-lg(class='focus:outline-none focus:ring-2 focus:ring-purple-500', type='number', min='0', max=book.numberOfPages, value=book.numberOfPagesRead, data-book-id=book._id)
                    button.bg-purple-600.text-white.px-4.py-2.rounded-lg.font-semibold.transition(class='hover:bg-purple-700', onclick=`updateProgress('${book._id}')`) Update
      
      //- All Books Section
      .mb-8
        h2.text-3xl.font-bold.text-gray-800.mb-6  All Books
        
        if books.length === 0
          .bg-white.rounded-lg.shadow.p-8.text-center
            p.text-gray-500.text-lg No books available. Add some books to start tracking!
        else
          .space-y-4
            each book in books
              .bg-white.rounded-lg.shadow-lg.p-6
                div(class='grid grid-cols-1 md:grid-cols-3 gap-6')
                  //- Book Info
                  .col-span-1
                    h3.text-xl.font-bold.text-gray-800.mb-2= book.title
                    p.text-gray-600.mb-1
                      span.font-semibold Author: 
                      span= book.author
                    if book.price
                      p.text-gray-600.mb-1
                        span.font-semibold Price: 
                        span $#{book.price}
                    div.flex.gap-2.mt-2
                      span.inline-block.bg-blue-100.text-blue-800.px-2.py-1.rounded.text-xs.font-semibold= book.format
                      span.inline-block.bg-green-100.text-green-800.px-2.py-1.rounded.text-xs.font-semibold= book.status
                  
                  //- Reading Progress
                  div(class='col-span-1 md:col-span-2')
                    .mb-4
                      .flex.justify-between.items-center.mb-2
                        span.font-semibold.text-gray-700 Reading Progress
                        span.text-lg.font-bold.text-purple-600= book.readingPercentage + '%'
                      .w-full.bg-gray-200.rounded-full.h-4
                        div.bg-gradient-to-r.from-purple-500.to-pink-500.h-4.rounded-full.transition-all.duration-500(style=`width: ${book.readingPercentage}%`)
                      p.text-sm.text-gray-500.mt-1= `${book.numberOfPagesRead} / ${book.numberOfPages} pages`
                    
                    //- Update Progress Form
                    .flex.gap-2.items-end
                      div.flex-1
                        label.block.text-sm.font-semibold.text-gray-700.mb-1(for=`pages-${book._id}`) Pages Read
                        input.w-full.px-3.py-2.border.rounded-lg(class='focus:outline-none focus:ring-2 focus:ring-purple-500', id=`pages-${book._id}`, type='number', min='0', max=book.numberOfPages, value=book.numberOfPagesRead, data-book-id=book._id)
                      button.bg-purple-600.text-white.px-6.py-2.rounded-lg.font-semibold.transition(class='hover:bg-purple-700', onclick=`updateProgress('${book._id}')`) Update Progress
    
    script.
      async function updateProgress(bookId) {
        const input = document.querySelector(`input[data-book-id="${bookId}"]`);
        const pagesRead = parseInt(input.value);
        
        if (isNaN(pagesRead) || pagesRead < 0) {
          alert('Please enter a valid number of pages');
          return;
        }
        
        try {
          const response = await fetch(`/books/api/books/${bookId}/progress`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ numberOfPagesRead: pagesRead })
          });
          
          const result = await response.json();
          
          if (response.ok) {
            // Reload page to show updated stats
            window.location.reload();
          } else {
            alert('Error: ' + result.message);
          }
        } catch (error) {
          alert('Error updating progress: ' + error.message);
        }
      }
